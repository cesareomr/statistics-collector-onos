//true
        } {
                % Stack: annot Ndict AS
                % Get the specified appearance.  If no appearance, then
                % display nothing - set stack = false.
          knownoget
        } ifelse
      } ifelse
    } {
      exch pop	% discard useless AP dictionary
    } ifelse

                % Stack: scalex scaley annot appearance true
                % Stack: scalex scaley annot false
    {
      dup type /dicttype eq {
                % Draw appearance
                % Initialize graphic following "7.4.4 Appearance Streams"
        q graphicsbeginpage textbeginpage
        1 index annotrect pop pop translate
        3 index 3 index scale	% Apply scale factors
        dup /BBox knownoget {
          1 index /Matrix knownoget not { {1 0 0 1 0 0} } if
          .bbox_transform pop pop
          % Compensate for non-zero origin of BBox
          neg exch neg exch translate
        } if
        DoForm Q
      } {
        (   **** Error: Annotation's appearance is not a dictionary.\n)
        pdfformaterror
        (               Output may be incorrect.\n) pdfformaterror
      } ifelse
    } if
  } {
    dup /MK knownoget {    % mk
      dup /BG knownoget {  % mk bg
        dup length         % mk bg len
        //set_bc_color exch .knownget {
           gsave
           exec
           3 index 3 index scale
           1 index annotrect rectfill
           grestore
        } {
          pop
        } ifelse
      } if
      dup /BC knownoget {
        dup length
        //set_bc_color exch .knownget {
           gsave
           exec
           1 setlinewidth
           3 index 3 index scale
           1 index annotrect rectstroke
           grestore
        } {
          pop
        } ifel